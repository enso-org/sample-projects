from Standard.Base import all
from Standard.Table import all
from Standard.Database import all
from Standard.AWS import all
from Standard.Geo import all
from Standard.Google_Api import all
from Standard.Microsoft import all
from Standard.Snowflake import all
from Standard.Tableau import all
import Standard.Examples
import Standard.Visualization

## ![Image](/images/Enso%20Analytics%20Example%20Project.png)

   # Challenge: Convert this data:
   ![Image](/images/image.png)

   # Into This Format![Image](/images/image_1.png)

   # Approach
   - Copy the values in Column H to Column A
   - Build out new column headers, as we need to use Quantum Widgetronics, etc as headers
   - - Take the first 2 rows
   - - add a row number to allow grouping in the next step
   - - Transpose using Row as the key column
   - - aggregate, concatenating the Value column. This will make column C look like "F5Quantum Widgetronics, Inc."
   - - Use a regular expression to replace all strings that start with F# (F and any number) with an empty string. This correctly changes the column to Quantum Widgetronics, Inc.
   - - remove the second column, so we only have a single column which contains the new column names
   - - Rename the columns
   - Work on summarizing the data as two distinct tables within the data. One that contains rows 3 and 4, and one that contains rows 5 and behond
   - in the case of the table in rows 5 and beyond, transpose the data using Customer No and Customer Name as the key column
   - In the case of the table in rows 2 & 3, transpose and crosstab the data to get into the correct shape
   - Join the two tables on the Entity columns
   - Reorder the columns and sort the data
   -  
main =
    quot1 = enso_project.data/ 'Data Challenge.xlsx'
    file1 = Data.read quot1
    node1 = file1.read 'Input' ..No_Headers on_problems=..Ignore
    any1 = node1.fill_nothing ['A'] (..Name 'H')
    any2 = any1.remove_columns ['H']
    ## Create Column Headers
    any7 = node1.take (..First 2)
    any8 = any7.add_row_number
    any9 = any8.transpose ['Row']
    any10 = any9.aggregate ['Name'] [..Concatenate 'Value']
    any11 = any10.text_replace ['Concatenate Value'] (regex "^F\d+") ""
    any13 = any11.remove_columns ['Name']
    any14 = any2.rename_columns any13 on_problems=..Ignore
    any15 = any14.drop (..First 1)
    any3 = any15.text_cleanse ['Customer No'] [..Symbols, ..Trailing_Whitespace]
    ## Build Upper Table
    any20 = any3.take (..First 3)
    any21 = any20.remove_columns ['Customer Name']
    any22 = any21.use_first_row_as_names ..Ignore
    any23 = any22.transpose ['Entity'] "Name"
    any24 = any23.cross_tab ['Name'] 'Entity' (..First 'Value')
    any25 = any24.rename_columns [(Pair.Value 'Name' 'Entity')]
    ## Build Lower Table
    any26 = any3.drop (..First 3)
    any36 = any26.transpose ['Customer No', 'Customer Name'] "Entity" on_problems=..Ignore
    any4 = any36.join any25 ..Inner [(..Equals 'Entity')]
    any5 = any4.reorder_columns ['Customer No', 'Customer Name', 'Entity', 'Item', 'Units', 'Value']
    any6 = any5.sort [(..Name 'Entity')]



#### METADATA ####
[[{"index":{"value":1727},"size":{"value":18}},"ff7a7106-366d-4d65-8470-b349e9fc45e1"],[{"index":{"value":1727},"size":{"value":40}},"da01714b-6721-4e93-83e8-3915e5492d3e"],[{"index":{"value":1780},"size":{"value":15}},"fcf199e6-d2b1-44b7-be92-a47545d6a593"],[{"index":{"value":1808},"size":{"value":18}},"027372b6-238f-43df-b319-93a5c140efa9"],[{"index":{"value":1808},"size":{"value":31}},"275b5e80-11df-437c-b932-99c626968cf9"],[{"index":{"value":1808},"size":{"value":52}},"794c38b3-da58-413a-8b9f-8426c230bd27"],[{"index":{"value":1872},"size":{"value":18}},"9045a72e-0941-4c3c-bc6a-19f25d5e9c89"],[{"index":{"value":1872},"size":{"value":24}},"02c23298-e311-4d6f-b289-0d586ff813cf"],[{"index":{"value":1872},"size":{"value":37}},"0da9b734-d397-4583-9343-ac6937b8c702"],[{"index":{"value":1921},"size":{"value":19}},"85ac608f-2fa8-427a-a78e-f2e1b96997e3"],[{"index":{"value":1921},"size":{"value":25}},"467398f2-bb1a-4050-aec3-6b45a34ece61"],[{"index":{"value":1987},"size":{"value":22}},"0f7594f2-c53a-4f33-bd3d-5538d66a8840"],[{"index":{"value":2021},"size":{"value":19}},"ac5362a0-f29d-46c9-93bc-f2a43fa0c774"],[{"index":{"value":2052},"size":{"value":22}},"6287e5ef-abf7-45e9-89af-783f3c9b1c67"],[{"index":{"value":2087},"size":{"value":47}},"50f93ff7-d6cb-4a89-bee9-1508facd1507"],[{"index":{"value":2147},"size":{"value":59}},"6e149c8a-6400-4507-9651-50111e272672"],[{"index":{"value":2219},"size":{"value":29}},"5d4aa219-834d-445d-851c-362d63258ff5"],[{"index":{"value":2261},"size":{"value":46}},"52c287c9-6873-4b2e-bf5c-980323c88df1"],[{"index":{"value":2320},"size":{"value":10}},"83566fa0-5491-47a5-bc1e-fdbdd44e82fd"],[{"index":{"value":2320},"size":{"value":22}},"fa889806-e7ec-470c-964b-a21f38371333"],[{"index":{"value":2354},"size":{"value":18}},"de66bf54-994b-44d8-aadc-9bfe26819577"],[{"index":{"value":2354},"size":{"value":34}},"50bdd21d-c54b-46a6-aa9b-d58643679d84"],[{"index":{"value":2354},"size":{"value":69}},"0649199e-597f-4426-99d9-46a0936a601c"],[{"index":{"value":2461},"size":{"value":9}},"870b2440-04bb-42eb-a5d7-3be2ea9e122a"],[{"index":{"value":2461},"size":{"value":21}},"0033535a-9c3d-4217-8db2-8096da0cda29"],[{"index":{"value":2495},"size":{"value":20}},"acaf650b-af32-4ebc-abdf-e645dcf665de"],[{"index":{"value":2495},"size":{"value":38}},"6dd829bd-6171-462b-a383-9c73390339b9"],[{"index":{"value":2546},"size":{"value":28}},"f382e135-6f53-4a92-935f-8c10ede4fe72"],[{"index":{"value":2546},"size":{"value":37}},"fee0d32b-fe9c-47dc-adff-9d32d63eda0c"],[{"index":{"value":2596},"size":{"value":15}},"707c8dc2-2ce4-46b3-8f53-01d530229f37"],[{"index":{"value":2596},"size":{"value":26}},"c5936481-06d5-4fd7-a712-68c8117f59fa"],[{"index":{"value":2596},"size":{"value":33}},"04cc5e66-0a85-4f4a-91bc-53c1af6a5219"],[{"index":{"value":2642},"size":{"value":15}},"cdb76634-91a7-40fc-a13a-4a0a53815aaa"],[{"index":{"value":2642},"size":{"value":24}},"de07c3a1-6969-4710-80cc-931d0ca9c653"],[{"index":{"value":2642},"size":{"value":33}},"890118a8-6e9c-4500-ba3c-488e5a4dc19d"],[{"index":{"value":2642},"size":{"value":51}},"189b6708-8090-433c-8529-e8dcacb7e3e5"],[{"index":{"value":2706},"size":{"value":20}},"c3f35afc-f8aa-4a89-93d2-09f8effc0b4f"],[{"index":{"value":2706},"size":{"value":51}},"4bc28a27-fc9f-4a84-985a-26a2d83635f6"],[{"index":{"value":2795},"size":{"value":9}},"85c5639b-de97-434d-85a5-c7cd8dc14d1c"],[{"index":{"value":2795},"size":{"value":21}},"c7a73992-75fa-459d-a3a7-5aa213b45679"],[{"index":{"value":2829},"size":{"value":15}},"73592e71-0345-4092-80ff-18c2d9da9aba"],[{"index":{"value":2829},"size":{"value":48}},"b7ebf54b-d3c8-4b79-a125-2f709c7fb7a3"],[{"index":{"value":2829},"size":{"value":57}},"988b680c-ae7a-4c32-b1b3-b7891f8dae19"],[{"index":{"value":2829},"size":{"value":78}},"cb34ac4b-db81-4c97-a11a-48e134a72ae5"],[{"index":{"value":2919},"size":{"value":10}},"3109a149-4a16-4e36-b52c-a5a47dac87db"],[{"index":{"value":2919},"size":{"value":16}},"b6ce549b-a0c5-4281-a369-28df2b8a8070"],[{"index":{"value":2919},"size":{"value":24}},"8ad6ed23-944f-4e04-802f-4549f4d73299"],[{"index":{"value":2919},"size":{"value":46}},"808db145-7af8-4b68-b18d-5db417deb96e"],[{"index":{"value":2977},"size":{"value":20}},"5f5b8fd7-097b-4f05-8a23-6f5977435a73"],[{"index":{"value":2977},"size":{"value":89}},"e5a3c000-26fa-433b-98a8-79602cb9c704"],[{"index":{"value":3078},"size":{"value":9}},"6840b653-ef66-407c-97f2-112b3e7635c7"],[{"index":{"value":3078},"size":{"value":29}},"adbe1ac2-485f-4161-bbc6-09067e2c0451"]]
{"ide":{"node":{"da01714b-6721-4e93-83e8-3915e5492d3e":{"position":{"vector":[-831,1273]}},"ff7a7106-366d-4d65-8470-b349e9fc45e1":{"position":{"vector":[5,371]}},"fcf199e6-d2b1-44b7-be92-a47545d6a593":{"position":{"vector":[-939,1201]},"visualization":{"show":false,"width":1129.671875,"height":252}},"794c38b3-da58-413a-8b9f-8426c230bd27":{"position":{"vector":[-939,1129]},"visualization":{"show":true,"width":1796.421875,"height":256.87890625}},"275b5e80-11df-437c-b932-99c626968cf9":{"position":{"vector":[-388,210]},"visualization":{"show":true,"width":1137.546875,"height":256.87890625}},"027372b6-238f-43df-b319-93a5c140efa9":{"position":{"vector":[-388,210]},"visualization":{"show":true,"width":1137.546875,"height":256.87890625}},"0da9b734-d397-4583-9343-ac6937b8c702":{"position":{"vector":[-939,791]},"visualization":{"show":false,"width":1124.14453125,"height":287.796875}},"02c23298-e311-4d6f-b289-0d586ff813cf":{"position":{"vector":[-346,-131]}},"9045a72e-0941-4c3c-bc6a-19f25d5e9c89":{"position":{"vector":[-346,-131]}},"467398f2-bb1a-4050-aec3-6b45a34ece61":{"position":{"vector":[-935,719]}},"85ac608f-2fa8-427a-a78e-f2e1b96997e3":{"position":{"vector":[-873,719]}},"0f7594f2-c53a-4f33-bd3d-5538d66a8840":{"position":{"vector":[-512,740]}},"ac5362a0-f29d-46c9-93bc-f2a43fa0c774":{"position":{"vector":[-512,668]}},"6287e5ef-abf7-45e9-89af-783f3c9b1c67":{"position":{"vector":[-512,596]},"visualization":{"show":false,"width":687.76171875}},"50f93ff7-d6cb-4a89-bee9-1508facd1507":{"position":{"vector":[-512,524]}},"6e149c8a-6400-4507-9651-50111e272672":{"position":{"vector":[-512,452]},"visualization":{"show":false,"width":600.46875,"height":275.109375}},"5d4aa219-834d-445d-851c-362d63258ff5":{"position":{"vector":[-512,380]}},"52c287c9-6873-4b2e-bf5c-980323c88df1":{"position":{"vector":[-936,273]},"visualization":{"show":false,"width":798.2734375,"height":289.59765625}},"fa889806-e7ec-470c-964b-a21f38371333":{"position":{"vector":[-936,201]},"visualization":{"show":false,"width":1684.2695118257368}},"83566fa0-5491-47a5-bc1e-fdbdd44e82fd":{"position":{"vector":[-247,66]}},"0649199e-597f-4426-99d9-46a0936a601c":{"position":{"vector":[-935,129]},"visualization":{"show":false,"width":864.5859375,"height":280.7578125}},"50bdd21d-c54b-46a6-aa9b-d58643679d84":{"position":{"vector":[-305,-973]}},"de66bf54-994b-44d8-aadc-9bfe26819577":{"position":{"vector":[-305,-973]}},"0033535a-9c3d-4217-8db2-8096da0cda29":{"position":{"vector":[61,57]},"visualization":{"show":false,"width":735.51171875}},"870b2440-04bb-42eb-a5d7-3be2ea9e122a":{"position":{"vector":[-524,-582]}},"6dd829bd-6171-462b-a383-9c73390339b9":{"position":{"vector":[61,-15]}},"acaf650b-af32-4ebc-abdf-e645dcf665de":{"position":{"vector":[-533,-913]}},"fee0d32b-fe9c-47dc-adff-9d32d63eda0c":{"position":{"vector":[61,-87]},"visualization":{"show":false,"width":592.796875}},"f382e135-6f53-4a92-935f-8c10ede4fe72":{"position":{"vector":[-152,-725]},"visualization":{"show":false,"width":592.796875}},"04cc5e66-0a85-4f4a-91bc-53c1af6a5219":{"position":{"vector":[61,-159]}},"c5936481-06d5-4fd7-a712-68c8117f59fa":{"position":{"vector":[-587,-1199]}},"707c8dc2-2ce4-46b3-8f53-01d530229f37":{"position":{"vector":[-587,-1199]}},"189b6708-8090-433c-8529-e8dcacb7e3e5":{"position":{"vector":[61,-231]},"visualization":{"show":false,"height":294.8828125}},"890118a8-6e9c-4500-ba3c-488e5a4dc19d":{"position":{"vector":[-568,-1513]}},"de07c3a1-6969-4710-80cc-931d0ca9c653":{"position":{"vector":[-568,-1513]}},"cdb76634-91a7-40fc-a13a-4a0a53815aaa":{"position":{"vector":[-568,-1513]}},"4bc28a27-fc9f-4a84-985a-26a2d83635f6":{"position":{"vector":[61,-303]},"visualization":{"show":true,"width":763.984375,"height":209.5234375}},"c3f35afc-f8aa-4a89-93d2-09f8effc0b4f":{"position":{"vector":[-558,-1859]}},"c7a73992-75fa-459d-a3a7-5aa213b45679":{"position":{"vector":[-936,22]},"visualization":{"show":false,"width":962.1640625}},"85c5639b-de97-434d-85a5-c7cd8dc14d1c":{"position":{"vector":[-700,-581]}},"cb34ac4b-db81-4c97-a11a-48e134a72ae5":{"position":{"vector":[-936,-50]},"visualization":{"show":true,"width":765.890625,"height":246.07923433150367}},"988b680c-ae7a-4c32-b1b3-b7891f8dae19":{"position":{"vector":[-1251,-886]},"visualization":{"show":false,"width":765.890625}},"b7ebf54b-d3c8-4b79-a125-2f709c7fb7a3":{"position":{"vector":[-1251,-886]},"visualization":{"show":false,"width":765.890625}},"73592e71-0345-4092-80ff-18c2d9da9aba":{"position":{"vector":[-1128,-1223]},"visualization":{"show":true,"width":545.66796875}},"808db145-7af8-4b68-b18d-5db417deb96e":{"position":{"vector":[-936,-585]},"visualization":{"show":false,"width":1081.2578125}},"8ad6ed23-944f-4e04-802f-4549f4d73299":{"position":{"vector":[-1075,-1209]}},"b6ce549b-a0c5-4281-a369-28df2b8a8070":{"position":{"vector":[-1075,-1209]}},"3109a149-4a16-4e36-b52c-a5a47dac87db":{"position":{"vector":[-1075,-1209]}},"e5a3c000-26fa-433b-98a8-79602cb9c704":{"position":{"vector":[-936,-657]}},"5f5b8fd7-097b-4f05-8a23-6f5977435a73":{"position":{"vector":[-1155,-1537]}},"adbe1ac2-485f-4161-bbc6-09067e2c0451":{"position":{"vector":[-936,-729]},"visualization":{"show":true,"width":1811.16796875,"height":520.407516347951}},"6840b653-ef66-407c-97f2-112b3e7635c7":{"position":{"vector":[-1216,-1605]}}},"widget":{},"import":{},"snapshot":"eJyFVtty2zYQffdXbOVJaU8VxKbs3Gb84Kh2rE6bprYTP6iuBiZXFGIQywCgZeXrOwtAlHzNE0ntnr2cXRxoaqmGMy9NKW0pPkiHoOqGrAep9cb0jvVcXulnzL9LL6+eDXB4cfa08SPSM0aiSuPksFFP+/ylCkuOpv5plzND86mW1z9rUrbrDum1czm6lXWj0T0wfFWulVr9kF6R2djY3IRfxqNaVni59Urx0706Mo5e5DuHRuqFV4V7ke+kcC/ync+WvmHhRWOq7Y0NANiE4UxqjabC9zAkc4PWg58pB6X08j27PMgQHushRsYTnDPomGwt/eOIye465rBpLMlixl8vYUjNAvwM4UbqFh0oA0PSbW3gBDwt3w+j84dW6RKo9WBwDkW0zVCWaF0fpIM5gkEsGdk6hH9aaXxbw4UqK/SWjCpcH9AX7JtwMfJLOOfRcSFTZZ2HHCzNO6MsS5D8C5i2vkLLCaTWNIfKUtsoU3HhjDZ468F5bLq4VhrXkENoHfud0pyzs+81LlITXZ6qslhJj30oyBTSo5GeUez+lRlKABFZnyutoebKExlD0ETXoNU1Qu94/3ECRqYQvWXKLw65NaxaLS3gbWPROUWGW7TYaFkgtwrOW2UqLlxyg9J6mCs/g+NN2DoGaUqQZpHo2Y4maQDrxi8SNtVckLVYeL2AYiZNhZGLVL+nJ4bGNS9LtljTTRyWw4JMmdB9cMQrQEYvYCZvuDHmXHfh5zNVzJhaL5VxaWDdJhlZYzfyU+TPtdqS5YLsNZAB19a1tOrHcjp8asJg5wSlcl6ZwoPnE+8CG2k/2E3A3wYjkV0pvG0wCDzu9cODHvfZD8YrnJEpY0UpcsH6SNPw7qOcmruQBZmyD75byK7suJnD1nmq0cInCoDVNxPxxM6OfpY8h19hsJ6VQ7OaOi+vViV4ggo9KBaUyHnYEnAz2WBM9QelTpnixCzFX46MV35xd1CnSLbko7qaYMjtKAhdzBtdYaOWysABf8H3lvwuHAAaR5MmySb7voKM76GVbopb7W6zAJoqjQxiB2FRljFMsBkqgy34RGM2Mk3rMxDiE01OohABGU53pbF2B0KMKkM2dM4Hi/EhjpgqrSeGeKEqGGeH2SVsCRFGlJ1k20tADgcBJ+JhmSwZGGcn2WVw2tyEoUXpsRPclSAy9E2X0rPAbAlxHJWxy/E25ngjZFlOLM0n8fQvze+i+a1YzX6cndI85efqdqLLO9EJH4wz7iW7hLEQw04DEbIgf2vY3dThjvB46ydLrRpn66gEgi2LFd5C77/jf8vfetvQ63VxBinOI1TFSjrPveiZCxu0YbLaKo7y7Pj2U5I9UVpqVmTudmQuy9iP7RQapQmMrR3LyMrZor4i7fogxLmVSitTTS5myqNrZIHdcONl+aVp0EL459GtRmJ9cG+wg9XyJG7znYec3FGFFTl5Wrh8V7QOJ+ESDTsh3SToKtznJE8d5/mdBYlHObuEHifoxpQvyR+IIB4TVo9uV5aoVTNpXVYtpQnke/enN976LJUV8XaNAbt42/fY/JPmD9h8vWTz7mRXbA6SR/76TqPrc+3DfV6hF0voPbtXiZTBa/GNxTH2KcTIGLQw3hLi6HsrtbvfjzSLRAezEWTy0Qk/Uli/i9WHbOSx5ucXo7zjl3tnNDW+L4LmjjudWlXzPyRD95A="}}